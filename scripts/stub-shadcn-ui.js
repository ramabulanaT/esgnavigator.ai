/* Auto-create missing "@/components/ui/*" modules to prevent Vite build errors */
const fs = require('fs'); const path = require('path');
const SRC = path.join(process.cwd(),'src'); const UI_DIR = path.join(SRC,'components','ui');
const TPL = {
  button:`import React from 'react';const c=(...a)=>a.filter(Boolean).join(' ');export const Button=React.forwardRef(function Button({className,variant='default',size='md',as:Tag='button',...p},ref){const base='inline-flex items-center justify-center rounded-lg border text-sm font-medium transition-colors focus:outline-none px-4 py-2';const variants={default:'bg-black text-white hover:opacity-90 border-transparent',outline:'bg-white text-black border-gray-300 hover:bg-gray-50',ghost:'bg-transparent text-black border-transparent hover:bg-gray-50'};const sizes={sm:'px-3 py-1.5 text-sm',md:'px-4 py-2 text-sm',lg:'px-5 py-3 text-base'};return <Tag ref={ref} className={c(base,variants[variant]||variants.default,sizes[size]||sizes.md,className)} {...p}/>;});`,
  card:`import React from 'react';const x=(...a)=>a.filter(Boolean).join(' ');export function Card({className,as:Tag='div',...p}){return <Tag className={x('cc-card',className)} {...p}/>;}export function CardHeader({className,as:Tag='div',...p}){return <Tag className={x('cc-card__header',className)} {...p}/>;}export function CardTitle({className,as:Tag='h3',...p}){return <Tag className={x('cc-card__title',className)} {...p}/>;}export function CardDescription({className,as:Tag='p',...p}){return <Tag className={x('cc-card__desc',className)} {...p}/>;}export function CardContent({className,as:Tag='div',...p}){return <Tag className={x('cc-card__content',className)} {...p}/>;}export function CardFooter({className,as:Tag='div',...p}){return <Tag className={x('cc-card__footer',className)} {...p}/>;}if(typeof document!=='undefined'&&!document.getElementById('cc-card-style')){const s=document.createElement('style');s.id='cc-card-style';s.textContent='.cc-card{border:1px solid #e5e7eb;border-radius:12px;background:#fff}.cc-card__header{padding:12px 16px;border-bottom:1px solid #f3f4f6}.cc-card__title{margin:0;font-size:1.1rem;font-weight:600}.cc-card__desc{margin:6px 0 0;color:#6b7280;font-size:.9rem}.cc-card__content{padding:16px}.cc-card__footer{padding:12px 16px;border-top:1px solid #f3f4f6}';document.head.appendChild(s);}`,
  input:`import React from 'react';export const Input=React.forwardRef(function Input(p,ref){return <input ref={ref} {...p} className={['block w-full rounded-lg border border-gray-300 px-3 py-2',p.className].filter(Boolean).join(' ')} />;});`,
  textarea:`import React from 'react';export const Textarea=React.forwardRef(function Textarea(p,ref){return <textarea ref={ref} {...p} className={['block w-full rounded-lg border border-gray-300 px-3 py-2',p.className].filter(Boolean).join(' ')} />;});`,
  label:`import React from 'react';export function Label({className,...p}){return <label {...p} className={['block text-sm font-medium text-gray-700 mb-1',className].filter(Boolean).join(' ')} />;}`,
  badge:`import React from 'react';export function Badge({children,className,variant='default',...p}){const v=variant==='secondary'?'bg-gray-100 text-gray-800':'bg-black text-white';return <span {...p} className={['inline-block text-xs font-medium px-2.5 py-1 rounded-full',v,className].filter(Boolean).join(' ')}>{children}</span>;}`,
  separator:`import React from 'react';export function Separator({className,...p}){return <hr {...p} className={['border-0 h-px bg-gray-200 my-4',className].filter(Boolean).join(' ')} />;}`,
  tabs:`import React,{createContext,useContext,useState} from 'react';const C=createContext(null);export function Tabs({defaultValue,value:on, onValueChange,children,className}){const [v,setV]=useState(defaultValue);const val=on??v;const set=(x)=> onValueChange?onValueChange(x):setV(x);return <C.Provider value={{value:val,set}}><div className={className}>{children}</div></C.Provider>;}export function TabsList({children,className}){return <div className={['inline-flex rounded-lg border border-gray-300 p-1 bg-white',className].filter(Boolean).join(' ')}>{children}</div>;}export function TabsTrigger({value,children,className}){const ctx=useContext(C);const a=ctx?.value===value;return <button type='button' onClick={()=>ctx?.set(value)} className={['px-3 py-1.5 rounded-md text-sm',a?'bg-black text-white':'text-black hover:bg-gray-100',className].filter(Boolean).join(' ')}>{children}</button>;}export function TabsContent({value,children,className}){const ctx=useContext(C);if(ctx?.value!==value)return null;return <div className={className}>{children}</div>;}`,
  select:`import React,{createContext,useContext,useEffect,useRef,useState} from 'react';const C=createContext(null);const cx=(...a)=>a.filter(Boolean).join(' ');export function Select({defaultValue,value:cv,onValueChange,children,disabled,open:co,onOpenChange,className}){const [v,setV]=useState(defaultValue??'');const [o,setO]=useState(false);const val=cv!==undefined?cv:v;const op=co!==undefined?co:o;const setVal=(x)=> onValueChange?onValueChange(x):setV(x);const setOp=(x)=> onOpenChange?onOpenChange(x):setO(x);return <C.Provider value={{value:val,setValue:setVal,open:op,setOpen:setOp,disabled:!!disabled}}><div className={className}>{children}</div></C.Provider>;}export function SelectTrigger({placeholder='Select…',className,children,...p}){const {value,open,setOpen,disabled}=useContext(C)??{};return <button type='button' disabled={disabled} onClick={()=>setOpen&&setOpen(!open)} className={cx('cc-select-trigger inline-flex items-center justify-between w-full rounded-lg border px-3 py-2 text-sm bg-white',disabled&&'opacity-60 cursor-not-allowed',className)} {...p}><span className='truncate'>{value||placeholder}</span><svg width='16' height='16' viewBox='0 0 20 20' fill='none' className={cx('ml-2 transition-transform',open&&'rotate-180')}><path d='M5 7l5 6 5-6' stroke='currentColor' strokeWidth='2' strokeLinecap='round' strokeLinejoin='round'/></svg>{children}</button>;}export function SelectValue({placeholder='Select…',className}){const {value}=useContext(C)??{};return <span className={className}>{value||placeholder}</span>;}export function SelectContent({className,children,sameWidth=true,...p}){const {open,setOpen}=useContext(C)??{};const ref=useRef(null);useEffect(()=>{function on(e){if(ref.current && !ref.current.contains(e.target)) setOpen?.(false);}if(open) document.addEventListener('mousedown',on);return ()=>document.removeEventListener('mousedown',on);},[open,setOpen]);if(!open) return null;return <div ref={ref} className={cx('cc-select-content absolute z-50 mt-2 max-h-72 overflow-auto rounded-lg border bg-white shadow-md',className)} style={{minWidth:sameWidth?'100%':undefined}} {...p}>{children}</div>;}export function SelectItem({value,children,className,...p}){const {value:val,setValue,setOpen}=useContext(C)??{};const sel=val===value;return <div role='option' aria-selected={sel} onClick={()=>{setValue?.(value);setOpen?.(false);}} className={cx('px-3 py-2 text-sm cursor-pointer hover:bg-gray-100',sel&&'bg-gray-100 font-medium',className)} {...p}>{children??String(value)}</div>;}if(typeof document!=='undefined'&&!document.getElementById('cc-select-style')){const s=document.createElement('style');s.id='cc-select-style';s.textContent='.cc-select-trigger{border-color:#e5e7eb}.cc-select-content{border-color:#e5e7eb}';document.head.appendChild(s);}`,
  dialog:`import React,{useContext,createContext,useEffect,useState} from 'react';const C=createContext(null);export function Dialog({open:co,onOpenChange,children}){const [o,set]=useState(!!co);useEffect(()=>{if(co!==undefined)set(!!co);},[co]);return <C.Provider value={{open:o,setOpen:(x)=>onOpenChange?onOpenChange(x):set(x)}}>{children}</C.Provider>;}export function DialogTrigger({children,...p}){const c=useContext(C)??{};return <span onClick={()=>c.setOpen?.(true)} {...p}>{children}</span>;}export function DialogContent({children}){const {open,setOpen}=useContext(C)??{};if(!open)return null;return <div style={S.o} onClick={()=>setOpen?.(false)}><div style={S.m} onClick={(e)=>e.stopPropagation()}>{children}</div></div>;}export const DialogHeader=({children})=><div style={{marginBottom:8}}>{children}</div>;export const DialogTitle=({children})=><h3 style={{margin:0}}>{children}</h3>;export const DialogDescription=({children})=><p style={{margin:'6px 0',color:'#6b7280'}}>{children}</p>;export const DialogFooter=({children})=><div style={{marginTop:12}}>{children}</div>;export const DialogClose=({children})=>{const {setOpen}=useContext(C)??{};return <button onClick={()=>setOpen?.(false)}>{children||'Close'}</button>;};const S={o:{position:'fixed',inset:0,background:'rgba(0,0,0,.4)',display:'grid',placeItems:'center',zIndex:9999},m:{background:'#fff',border:'1px solid #e5e7eb',borderRadius:12,padding:16,minWidth:280,maxWidth:'90vw'}};`,
  'dropdown-menu':`import React,{createContext,useContext,useRef,useEffect,useState} from 'react';const C=createContext(null);export function DropdownMenu({children}){const [o,set]=useState(false);return <C.Provider value={{open:o,setOpen:set}}>{children}</C.Provider>;}export function DropdownMenuTrigger({children}){const {open,setOpen}=useContext(C)??{};return <span onClick={()=>setOpen?.(!open)}>{children}</span>;}export function DropdownMenuContent({children}){const {open,setOpen}=useContext(C)??{};const r=useRef(null);useEffect(()=>{function on(e){if(r.current&&!r.current.contains(e.target))setOpen?.(false);}if(open)document.addEventListener('mousedown',on);return()=>document.removeEventListener('mousedown',on);},[open,setOpen]);if(!open)return null;return <div ref={r} style={{position:'absolute',marginTop:8,background:'#fff',border:'1px solid #e5e7eb',borderRadius:10,boxShadow:'0 6px 20px rgba(0,0,0,.08)'}}>{children}</div>; }export const DropdownMenuItem=({children,onSelect})=> <div onClick={(e)=>{onSelect?.(e)}} style={{padding:'8px 12px',cursor:'pointer'}}>{children}</div>;export const DropdownMenuSeparator=()=> <div style={{height:1,background:'#f3f4f6',margin:'6px 0'}}/>;export const DropdownMenuLabel=({children})=> <div style={{padding:'8px 12px',fontWeight:600,opacity:.7}}>{children}</div>;`,
  table:`import React from 'react';const x=(...a)=>a.filter(Boolean).join(' ');export const Table=(p)=><table {...p} className={x('min-w-full border-collapse',p.className)}/>;export const TableHeader=(p)=><thead {...p}/>;export const TableBody=(p)=><tbody {...p}/>;export const TableRow=(p)=><tr {...p}/>;export const TableHead=(p)=><th {...p} className={x('text-left border-b px-3 py-2',p.className)}/>;export const TableCell=(p)=><td {...p} className={x('border-b px-3 py-2',p.className)}/>;export const TableCaption=(p)=><caption {...p}/>;export const TableFooter=(p)=><tfoot {...p}/>;`,
  switch:`import React from 'react';export const Switch=({checked=false,onCheckedChange})=>{const [v,setV]=React.useState(!!checked);return <div onClick={()=>{setV(!v);onCheckedChange?.(!v);}} style={{width:44,height:24,borderRadius:12,background:v?'#111827':'#e5e7eb',position:'relative',cursor:'pointer'}}><div style={{width:20,height:20,borderRadius:10,background:'#fff',position:'absolute',top:2,left:v?22:2,boxShadow:'0 1px 2px rgba(0,0,0,.2)'}}/></div>;};`,
  checkbox:`import React from 'react';export const Checkbox=({checked=false,onCheckedChange,...p})=>{const [v,setV]=React.useState(!!checked);return <input type='checkbox' checked={v} onChange={(e)=>{setV(e.target.checked);onCheckedChange?.(e.target.checked);}} {...p}/>;};`,
  tooltip:`import React,{createContext,useContext,useState} from 'react';const C=createContext(null);export const TooltipProvider=({children})=> children;export function Tooltip({children}){const [o,set]=useState(false);return <C.Provider value={{o,set}}>{children}</C.Provider>;}export function TooltipTrigger({children}){const {set}=useContext(C)??{};return <span onMouseEnter={()=>set?.(true)} onMouseLeave={()=>set?.(false)}>{children}</span>;}export function TooltipContent({children}){const {o}=useContext(C)??{};if(!o)return null;return <div style={{position:'absolute',background:'#111827',color:'#fff',padding:'6px 8px',borderRadius:6,marginTop:6,fontSize:12}}>{children}</div>;}`,
  sheet:`import React,{createContext,useContext,useState} from 'react';const C=createContext(null);export function Sheet({children,open:co,onOpenChange}){const [o,set]=useState(!!co);const setO=(x)=> onOpenChange?onOpenChange(x):set(x);return <C.Provider value={{o,setO}}>{children}</C.Provider>;}export const SheetTrigger=({children})=>{const {o,setO}=useContext(C)??{};return <span onClick={()=>setO?.(!o)}>{children}</span>;};export function SheetContent({side='right',children}){const {o,setO}=useContext(C)??{};if(!o)return null;const pos=side==='left'?{left:0}:{right:0};return <div onClick={()=>setO?.(false)} style={{position:'fixed',inset:0,background:'rgba(0,0,0,.4)'}}><div onClick={(e)=>e.stopPropagation()} style={{position:'absolute',top:0,bottom:0,...pos,width:'80vw',maxWidth:420,background:'#fff',borderLeft:'1px solid #e5e7eb',borderRight:'1px solid #e5e7eb'}}>{children}</div></div>; }export const SheetHeader=({children})=><div style={{padding:12,borderBottom:'1px solid #f3f4f6'}}>{children}</div>;export const SheetTitle=({children})=><h3 style={{margin:0}}>{children}</h3>;export const SheetDescription=({children})=><p style={{margin:'6px 0',color:'#6b7280'}}>{children}</p>;export const SheetFooter=({children})=><div style={{padding:12,borderTop:'1px solid #f3f4f6'}}>{children}</div>;export const SheetClose=({children})=>{const {setO}=useContext(C)??{};return <button onClick={()=>setO?.(false)}>{children||'Close'}</button>;};`,
  popover:`import React,{createContext,useContext,useRef,useEffect,useState} from 'react';const C=createContext(null);export function Popover({children}){const [o,set]=useState(false);return <C.Provider value={{o,set}}>{children}</C.Provider>;}export const PopoverTrigger=({children})=>{const {o,set}=useContext(C)??{};return <span onClick={()=>set?.(!o)}>{children}</span>;};export function PopoverContent({children}){const {o,set}=useContext(C)??{};const r=useRef(null);useEffect(()=>{function on(e){if(r.current && !r.current.contains(e.target)) set?.(false);}if(o)document.addEventListener('mousedown',on);return ()=>document.removeEventListener('mousedown',on);},[o,set]);if(!o)return null;return <div ref={r} style={{position:'absolute',marginTop:8,background:'#fff',border:'1px solid #e5e7eb',borderRadius:10,boxShadow:'0 6px 20px rgba(0,0,0,.08)'}}>{children}</div>; }`,
  skeleton:`import React from 'react';export function Skeleton({className,...p}){return <div {...p} className={['animate-pulse bg-gray-200 rounded',className].filter(Boolean).join(' ')} />;}`,
  progress:`import React from 'react';export function Progress({value=0,className,...p}){return <div className={['h-2 bg-gray-200 rounded',className].join(' ')} {...p}><div style={{width:Math.max(0,Math.min(100,value))+'%'}} className='h-2 bg-black rounded'/></div>;}`,
  slider:`import React from 'react';export function Slider({value=[0],min=0,max=100,step=1,onValueChange}){const v=value[0]??0;return <input type='range' min={min} max={max} step={step} value={v} onChange={(e)=>onValueChange?.([Number(e.target.value)])} />;}`,
  toast:`import React from 'react';export const Toaster=()=>null; export const Toast=()=>null; export const useToast=()=>({ toast: ()=>{} });`,
};
const FALLBACK = (name)=>`import React from 'react'; export default function ${name.replace(/[^a-z0-9]/ig,'_')}(p){return <div {...p}/>}`;
const exts=new Set(['.js','.jsx','.ts','.tsx']);
function walk(d, out=[]){ for(const e of fs.readdirSync(d,{withFileTypes:true})){ if(e.name.startsWith('.')) continue; const p=path.join(d,e.name); if(e.isDirectory()) walk(p,out); else if(exts.has(path.extname(e.name))) out.push(p); } return out; }
function ensureDir(p){ fs.mkdirSync(path.dirname(p),{recursive:true}); }
function main(){
  if(!fs.existsSync(SRC)){ console.error('❌ src/ not found'); process.exit(1); }
  ensureDir(UI_DIR);
  const files=walk(SRC); const needs=new Set(); const rx=/from\s+["']@\/components\/ui\/([^"']+)["']/g;
  for(const f of files){ const s=fs.readFileSync(f,'utf8'); for(const m of s.matchAll(rx)){ const name=m[1].trim(); if(name) needs.add(name); } }
  let created=0;
  for(const name of needs){
    const base=path.join(UI_DIR,name);
    const exists=['.jsx','.tsx','.js','.ts'].some(ext=>fs.existsSync(base+ext));
    if(exists) continue;
    const tpl = TPL[name] || FALLBACK(name);
    ensureDir(base+'.jsx'); fs.writeFileSync(base+'.jsx',tpl,'utf8'); console.log('🧩 created', path.relative(process.cwd(),base+'.jsx')); created++;
  }
  console.log(created?`✅ created ${created} ui stub(s)`: '✅ no missing ui stubs');
}
main();
